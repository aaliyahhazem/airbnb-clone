  <div class="container py-4">

  <div class="d-flex align-items-center justify-content-between mb-3">
    <h2 class="mb-0">Property Listings</h2>
    <a class="btn btn-success" [routerLink]="['/host/create']">+ Add Listing</a>
  </div>

  <!-- Loading -->
  <div *ngIf="loading()" class="alert alert-info">
    <strong>Loading listings...</strong>
  </div>

  <!-- Error -->
  <div *ngIf="error() && !loading()" class="alert alert-danger">
    <strong>Error:</strong> {{ error() }}
  </div>

  <!-- Filters -->
  <div class="card mb-3">
    <div class="card-body">
      <div class="row g-3 align-items-end">

        <div class="col-12 col-md-4">
          <label class="form-label">Search</label>
          <input type="text" class="form-control"
                 placeholder="Search..."
                 [ngModel]="search()"
                 (ngModelChange)="search.set($event)" />
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label">Location</label>
          <select class="form-select"
                  [ngModel]="location()"
                  (ngModelChange)="location.set($event)">
            <option value="">All</option>
            <option *ngFor="let loc of locations()" [value]="loc">
              {{ loc }}
            </option>
          </select>
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label">Min Price</label>
          <input type="number" class="form-control"
                 [ngModel]="minPrice()"
                 (ngModelChange)="minPrice.set($event === '' ? null : +$event)">
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label">Max Price</label>
          <input type="number" class="form-control"
                 [ngModel]="maxPrice()"
                 (ngModelChange)="maxPrice.set($event === '' ? null : +$event)">
        </div>

        <div class="col-6 col-md-2">
          <label class="form-label">Min Rating</label>
          <input type="number" class="form-control"
                 [ngModel]="minRating()"
                 (ngModelChange)="minRating.set($event === '' ? null : +$event)"
                 min="0" max="5" step="0.5">
        </div>

      </div>

      <div class="d-flex mt-3">
        <button class="btn btn-outline-secondary btn-sm" (click)="resetFilters()">Reset</button>
        <div class="ms-auto text-muted">{{ filtered().length }} results</div>
      </div>
    </div>
  </div>

  <!-- Empty -->
  <div *ngIf="filtered().length === 0" class="alert alert-light border">
    No listings found.
  </div>

  <!-- Results -->
  <div class="row g-3" *ngIf="filtered().length > 0">

    <div class="col-12 col-sm-6 col-lg-4" *ngFor="let l of filtered(); trackBy: trackById">
      <div class="card h-100 shadow-sm">

        <img [src]="l.mainImageUrl ? (l.mainImageUrl.indexOf('http') === 0 ? l.mainImageUrl : 'http://localhost:5235' + l.mainImageUrl) : 'assets/default-listing.svg'"
             class="card-img-top"
             style="height: 180px; object-fit: cover" />

        <div class="card-body d-flex flex-column">

          <h5 class="card-title">{{ l.title }}</h5>
          <p class="text-muted small mb-2">{{ l.location }}</p>

          <p class="text-muted small">
            ★ {{ l.averageRating || 0 }} / 5 ({{ l.reviewCount }} reviews)
          </p>

          <div class="mt-auto d-flex justify-content-between align-items-center">
            <span class="badge bg-primary">${{ l.pricePerNight }}/night</span>

            <div class="btn-group btn-group-sm">

              <!-- ⭐ DETAILS ROUTE ⭐ -->
              <a class="btn btn-outline-secondary" [routerLink]="['/listings', l.id]">View</a>

              <!-- ⭐ EDIT ROUTE ⭐ -->
              <a class="btn btn-outline-primary" [routerLink]="['/listings', l.id, 'edit']">Edit</a>

              <button class="btn btn-outline-danger" (click)="onDelete(l.id)">
                Delete
              </button>

            </div>
          </div>

        </div>

      </div>
    </div>

  </div>

</div>
