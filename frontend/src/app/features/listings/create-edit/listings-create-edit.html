<div class="broker-create-container">
  <!-- Background Elements -->
  <div class="create-background-pattern"></div>
  <div class="create-floating-elements">
    <div class="floating-element element-1"></div>
    <div class="floating-element element-2"></div>
    <div class="floating-element element-3"></div>
  </div>

  <!-- Character Section -->
  <div class="create-character-section">
    <div class="create-character-container">
      <img src="/3.png" alt="The Broker Character" class="create-character" />
      <div class="create-accent-circle"></div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="listing-form-container">
    <div class="form-header">
        <h2>{{ editMode ? ('createEditListing.editListing' | translate) : ('createEditListing.createNewListing' | translate) }}</h2>
        <!-- <button class="btn-back" (click)="goBack()">← Back</button> -->
    </div>

    <!-- Messages -->
    <div *ngIf="error" class="alert alert-error">{{ error }}</div>
    <div *ngIf="successMessage" class="alert alert-success">{{ successMessage }}</div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-content">
        <!-- Basic Information -->
        <div class="section">
            <h3>{{ 'createEditListing.basicInformation' | translate }}</h3>

            <div class="form-group">
                <label for="title">{{ 'createEditListing.title' | translate }} *</label>
                <input
                    id="title"
                    type="text"
                    formControlName="title"
                    [placeholder]="'createEditListing.titlePlaceholder' | translate"
                    [class.is-invalid]="isInvalid('title')"
                />
                <small *ngIf="isInvalid('title')" class="error-text">
                    {{ 'createEditListing.titleError' | translate }}
                </small>
            </div>

            <div class="form-group">
                <label for="description">{{ 'createEditListing.description' | translate }} *</label>
                <textarea
                    id="description"
                    formControlName="description"
                    [placeholder]="'createEditListing.descriptionPlaceholder' | translate"
                    rows="5"
                    [class.is-invalid]="isInvalid('description')"
                ></textarea>
                <small *ngIf="isInvalid('description')" class="error-text">
                    {{ 'createEditListing.descriptionError' | translate }}
                </small>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="pricePerNight">{{ 'createEditListing.pricePerNight' | translate }} *</label>
                    <input
                        id="pricePerNight"
                        type="number"
                        formControlName="pricePerNight"
                        placeholder="0"
                        [class.is-invalid]="isInvalid('pricePerNight')"
                    />
                    <small *ngIf="isInvalid('pricePerNight')" class="error-text">
                        {{ 'createEditListing.priceError' | translate }}
                    </small>
                </div>

                <div class="form-group">
                    <label for="maxGuests">{{ 'createEditListing.maxGuests' | translate }} *</label>
                    <input
                        id="maxGuests"
                        type="number"
                        formControlName="maxGuests"
                        placeholder="1"
                        [class.is-invalid]="isInvalid('maxGuests')"
                    />
                    <small *ngIf="isInvalid('maxGuests')" class="error-text">
                        {{ 'createEditListing.maxGuestsError' | translate }}
                    </small>
                </div>
            </div>
        </div>

        <!-- Location Information -->
        <div class="section">
            <h3>{{ 'createEditListing.locationInformation' | translate }}</h3>

            <div class="form-group">
                <label for="location">{{ 'createEditListing.location' | translate }} *</label>
                <input
                    id="location"
                    type="text"
                    formControlName="location"
                    [placeholder]="'createEditListing.locationPlaceholder' | translate"
                    [class.is-invalid]="isInvalid('location')"
                />
                <small *ngIf="isInvalid('location')" class="error-text">
                    {{ 'createEditListing.locationError' | translate }}
                </small>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="destination">{{ 'createEditListing.destination' | translate }} *</label>
                    <input
                        id="destination"
                        type="text"
                        formControlName="destination"
                        [placeholder]="'createEditListing.destinationPlaceholder' | translate"
                        [class.is-invalid]="isInvalid('destination')"
                    />
                    <small *ngIf="isInvalid('destination')" class="error-text">
                        {{ 'createEditListing.destinationError' | translate }}
                    </small>
                </div>

                <div class="form-group">
                    <label for="type">{{ 'createEditListing.propertyType' | translate }} *</label>
                    <select
                        id="type"
                        formControlName="type"
                        [class.is-invalid]="isInvalid('type')"
                    >
                        <option value="">{{ 'createEditListing.selectType' | translate }}</option>
                        <option value="Apartment">{{ 'createEditListing.apartment' | translate }}</option>
                        <option value="House">{{ 'createEditListing.house' | translate }}</option>
                        <option value="Villa">{{ 'createEditListing.villa' | translate }}</option>
                        <option value="Studio">{{ 'createEditListing.studio' | translate }}</option>
                        <option value="Penthouse">{{ 'createEditListing.penthouse' | translate }}</option>
                    </select>
                    <small *ngIf="isInvalid('type')" class="error-text">
                        {{ 'createEditListing.propertyTypeError' | translate }}
                    </small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="latitude">{{ 'createEditListing.latitude' | translate }} *</label>
                    <input
                        id="latitude"
                        type="number"
                        formControlName="latitude"
                        step="0.0001"
                        placeholder="30.0444"
                        [class.is-invalid]="isInvalid('latitude')"
                    />
                    <small *ngIf="isInvalid('latitude')" class="error-text">
                        {{ 'createEditListing.latitudeError' | translate }}
                    </small>
                </div>

                <div class="form-group">
                    <label for="longitude">{{ 'createEditListing.longitude' | translate }} *</label>
                    <input
                        id="longitude"
                        type="number"
                        formControlName="longitude"
                        step="0.0001"
                        placeholder="31.2357"
                        [class.is-invalid]="isInvalid('longitude')"
                    />
                    <small *ngIf="isInvalid('longitude')" class="error-text">
                        {{ 'createEditListing.longitudeError' | translate }}
                    </small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="bedrooms">{{ 'createEditListing.bedrooms' | translate }} *</label>
                    <input
                        id="bedrooms"
                        type="number"
                        formControlName="bedrooms"
                        placeholder="1"
                        min="1"
                        [class.is-invalid]="isInvalid('bedrooms')"
                    />
                    <small *ngIf="isInvalid('bedrooms')" class="error-text">
                        {{ 'createEditListing.bedroomsError' | translate }}
                    </small>
                </div>

                <div class="form-group">
                    <label for="bathrooms">{{ 'createEditListing.bathrooms' | translate }} *</label>
                    <input
                        id="bathrooms"
                        type="number"
                        formControlName="bathrooms"
                        placeholder="1"
                        min="1"
                        [class.is-invalid]="isInvalid('bathrooms')"
                    />
                    <small *ngIf="isInvalid('bathrooms')" class="error-text">
                        {{ 'createEditListing.bathroomsError' | translate }}
                    </small>
                </div>
            </div>

            <div class="form-group">
                <button type="button" class="btn btn-outline-primary" (click)="toggleMapPicker()">
                    {{ showMapPicker ? ('createEditListing.closeMap' | translate) : ('createEditListing.pickLocationOnMap' | translate) }}
                </button>
            </div>

            <div *ngIf="showMapPicker" class="map-picker">
                <div id="picker-map" style="height: 320px; width: 100%; border: 1px solid #ddd; margin-bottom:8px;"></div>
                <div class="picker-actions">
                    <button type="button" class="btn btn-primary" (click)="confirmPickedLocation()">{{ 'createEditListing.confirmLocation' | translate }}</button>
                    <button type="button" class="btn btn-secondary" (click)="toggleMapPicker()">{{ 'createEditListing.cancel' | translate }}</button>
                </div>
            </div>
        </div>

        <!-- Amenities -->
        <div class="section">
            <h3>{{ 'createEditListing.amenities' | translate }}</h3>
            <div class="amenities-grid">
                <button
                    *ngFor="let amenity of amenitiesList"
                    type="button"
                    class="amenity-btn"
                    [class.selected]="isAmenitySelected(amenity)"
                    (click)="toggleAmenity(amenity)"
                >
                    {{ amenity }}
                </button>
            </div>
        </div>

        <!-- Images -->
        <div class="section">
            <h3>{{ 'createEditListing.images' | translate }}</h3>

            <!-- Existing Images (Edit Mode) -->
            <div *ngIf="editMode && existingImages.length > 0" class="image-section">
                <h4>{{ 'createEditListing.currentImages' | translate }}</h4>
                <div class="images-grid">
                    <div *ngFor="let img of existingImages" class="image-item">
                        <img [src]="img.url" [alt]="'Listing image'" />
                        <button
                            type="button"
                            class="btn-remove"
                            (click)="removeExistingImage(img.id)"
                        >
                            ✕
                        </button>
                    </div>
                </div>
            </div>

            <!-- New Images -->
            <div class="image-section">
                <label for="images">{{ editMode ? ('createEditListing.addNewImages' | translate) : ('createEditListing.uploadImages' | translate) }}</label>
                <input
                    id="images"
                    type="file"
                    multiple
                    accept="image/*"
                    (change)="onFileChange($event)"
                />
                <!-- <small class="help-text">You can upload multiple images. The first will be set as main.</small> -->
            </div>

            <!-- Image Previews -->
            <div *ngIf="imagePreviews.length > 0" class="image-section">
                <!-- <h4>New Images Preview</h4> -->
                <div class="images-grid">
                    <div *ngFor="let preview of imagePreviews; let i = index" class="image-item">
                        <img [src]="preview" [alt]="'Preview ' + (i + 1)" />
                        <button
                            type="button"
                            class="btn-remove"
                            (click)="removeNewImage(i)"
                        >
                            ✕
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <button
                type="submit"
                class="btn btn-primary"
                [disabled]="loading || form.invalid"
            >
                {{ loading ? ('createEditListing.saving' | translate) : (editMode ? ('createEditListing.update' | translate) : ('createEditListing.create' | translate)) }}
            </button>

            <button
                *ngIf="editMode"
                type="button"
                class="btn btn-danger"
                (click)="onDelete()"

            >
                {{ 'createEditListing.delete' | translate }}
            </button>

            <button
                type="button"
                class="btn btn-secondary"
                (click)="goBack()"
            >
                {{ 'createEditListing.cancel' | translate }}
            </button>
        </div>
    </form>
</div>

</div>
